<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
        namespace="com.example.study_system.dao.QuestionInfoMapper">
    <resultMap id="BaseResultMap"
               type="com.example.study_system.model.QuestionInfo">
        <id column="question_id" property="questionId" jdbcType="BIGINT"/>
        <result column="question_type" property="questionType"
                jdbcType="INTEGER"/>
        <result column="score" property="score" jdbcType="REAL"/>
        <result column="difficulty" property="difficulty"
                jdbcType="INTEGER"/>
        <result column="STATUS" property="status" jdbcType="INTEGER"/>
        <result column="c_time" property="cTime" jdbcType="TIMESTAMP"/>
        <result column="m_time" property="mTime" jdbcType="TIMESTAMP"/>
        <result column="c_user" property="cUser" jdbcType="VARCHAR"/>
        <result column="m_user" property="mUser" jdbcType="VARCHAR"/>
    </resultMap>
    <resultMap id="ResultMapWithBLOBs"
               type="com.example.study_system.model.QuestionInfoWithBLOBs"
               extends="BaseResultMap">
        <result column="content" property="content"
                jdbcType="LONGVARCHAR"/>
        <result column="analysis" property="analysis"
                jdbcType="LONGVARCHAR"/>
        <result column="option_type" property="optionType"
                jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Base_Column_List">
		question_id, question_type, score, difficulty, STATUS,
		c_time, m_time, c_user,
		m_user
	</sql>
    <sql id="Blob_Column_List">
		content, analysis
	</sql>
    <select id="selectByPrimaryKey" resultMap="ResultMapWithBLOBs"
            parameterType="java.lang.Long">
        select
        <include refid="Base_Column_List"/>
        ,
        <include refid="Blob_Column_List"/>
        from question_info
        where question_id = #{questionId,jdbcType=BIGINT}
    </select>
    <select id="selectQuestionCountNum" resultType="java.lang.Integer"
            parameterType="java.lang.String">
        select count(question_id) from question_info
        <if test="content != null">
            where
            content like "%"#{content,jdbcType=LONGVARCHAR}"%"
            <if test="questionType != null">
                and question_type = #{questionType,jdbcType=INTEGER}
            </if>
        </if>
    </select>
    <select id="selectQuestionCount" resultType="java.lang.Integer"
            parameterType="java.lang.Integer">
        select count(question_id) from question_info
        <if test="questionType != null">
            where
            question_type= #{questionType,jdbcType=INTEGER}
        </if>

    </select>
    <select id="selectAnalysisById" resultMap="ResultMapWithBLOBs"
            parameterType="java.lang.Long">
		select question.analysis,qOption.ref,qOption.option_type from
		question_info
		question left
		join
		j_question_option qOption on question.question_id = qOption.question_id
		where
		qOption.is_right = 1 and question.question_id = #{questionId,jdbcType=BIGINT}
		ORDER
		BY question.c_time desc;
	</select>
    <select id="selectAllQuestion" resultMap="ResultMapWithBLOBs"
            parameterType="java.lang.String">
        select
        <include refid="Base_Column_List"/>
        ,
        <include refid="Blob_Column_List"/>
        from question_info
        <if test="content != null">
            where
            content like "%"#{content,jdbcType=LONGVARCHAR}"%"
            <if test="questionType != null">
                and question_type = #{questionType,jdbcType=INTEGER}
            </if>
        </if>
        ORDER BY c_time desc
    </select>
    <select id="selectByQuestionIds" resultMap="ResultMapWithBLOBs">
        select
        <include refid="Base_Column_List"/>
        ,
        <include refid="Blob_Column_List"/>
        from question_info
        where question_id in
        <foreach collection="ids" item="questionId" index="index" open="(" close=")" separator=",">
            #{questionId}
        </foreach>
        ORDER BY c_time desc
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
		delete from
		question_info
		where question_id = #{questionId,jdbcType=BIGINT}
	</delete>
    <insert id="insert"
            parameterType="com.example.study_system.model.QuestionInfoWithBLOBs">
		insert into question_info (question_id, question_type,
		score,
		difficulty, STATUS, c_time,
		m_time, c_user, m_user,
		content,
		analysis)
		values (#{questionId,jdbcType=BIGINT},
		#{questionType,jdbcType=INTEGER},
		#{score,jdbcType=REAL},
		#{difficulty,jdbcType=INTEGER}, #{status,jdbcType=INTEGER},
		#{cTime,jdbcType=TIMESTAMP},
		#{mTime,jdbcType=TIMESTAMP},
		#{cUser,jdbcType=VARCHAR},
		#{mUser,jdbcType=VARCHAR},
		#{content,jdbcType=LONGVARCHAR}, #{analysis,jdbcType=LONGVARCHAR})
	</insert>
    <insert id="insertSelective"
            parameterType="com.example.study_system.model.QuestionInfoWithBLOBs"
            keyColumn="question_id" keyProperty="questionId"
            useGeneratedKeys="true">
        insert into question_info
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="questionId != null">
                question_id,
            </if>
            <if test="questionType != null">
                question_type,
            </if>
            <if test="score != null">
                score,
            </if>
            <if test="difficulty != null">
                difficulty,
            </if>
            <if test="status != null">
                STATUS,
            </if>
            <if test="cTime != null">
                c_time,
            </if>
            <if test="mTime != null">
                m_time,
            </if>
            <if test="cUser != null">
                c_user,
            </if>
            <if test="mUser != null">
                m_user,
            </if>
            <if test="content != null">
                content,
            </if>
            <if test="analysis != null">
                analysis,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="questionId != null">
                #{questionId,jdbcType=BIGINT},
            </if>
            <if test="questionType != null">
                #{questionType,jdbcType=INTEGER},
            </if>
            <if test="score != null">
                #{score,jdbcType=REAL},
            </if>
            <if test="difficulty != null">
                #{difficulty,jdbcType=INTEGER},
            </if>
            <if test="status != null">
                #{status,jdbcType=INTEGER},
            </if>
            <if test="cTime != null">
                #{cTime,jdbcType=TIMESTAMP},
            </if>
            <if test="mTime != null">
                #{mTime,jdbcType=TIMESTAMP},
            </if>
            <if test="cUser != null">
                #{cUser,jdbcType=VARCHAR},
            </if>
            <if test="mUser != null">
                #{mUser,jdbcType=VARCHAR},
            </if>
            <if test="content != null">
                #{content,jdbcType=LONGVARCHAR},
            </if>
            <if test="analysis != null">
                #{analysis,jdbcType=LONGVARCHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective"
            parameterType="com.example.study_system.model.QuestionInfoWithBLOBs">
        update question_info
        <set>
            <if test="questionType != null">
                question_type = #{questionType,jdbcType=INTEGER},
            </if>
            <if test="score != null">
                score = #{score,jdbcType=REAL},
            </if>
            <if test="difficulty != null">
                difficulty = #{difficulty,jdbcType=INTEGER},
            </if>
            <if test="status != null">
                STATUS = #{status,jdbcType=INTEGER},
            </if>
            <if test="cTime != null">
                c_time = #{cTime,jdbcType=TIMESTAMP},
            </if>
            <if test="mTime != null">
                m_time = #{mTime,jdbcType=TIMESTAMP},
            </if>
            <if test="cUser != null">
                c_user = #{cUser,jdbcType=VARCHAR},
            </if>
            <if test="mUser != null">
                m_user = #{mUser,jdbcType=VARCHAR},
            </if>
            <if test="content != null">
                content = #{content,jdbcType=LONGVARCHAR},
            </if>
            <if test="analysis != null">
                analysis = #{analysis,jdbcType=LONGVARCHAR},
            </if>
        </set>
        where question_id = #{questionId,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKeyWithBLOBs"
            parameterType="com.example.study_system.model.QuestionInfoWithBLOBs">
		update question_info
		set question_type =
		#{questionType,jdbcType=INTEGER},
		score = #{score,jdbcType=REAL},
		difficulty = #{difficulty,jdbcType=INTEGER},
		STATUS =
		#{status,jdbcType=INTEGER},
		c_time = #{cTime,jdbcType=TIMESTAMP},
		m_time = #{mTime,jdbcType=TIMESTAMP},
		c_user =
		#{cUser,jdbcType=VARCHAR},
		m_user = #{mUser,jdbcType=VARCHAR},
		content =
		#{content,jdbcType=LONGVARCHAR},
		analysis =
		#{analysis,jdbcType=LONGVARCHAR}
		where question_id =
		#{questionId,jdbcType=BIGINT}
	</update>
    <update id="updateByPrimaryKey"
            parameterType="com.example.study_system.model.QuestionInfo">
		update question_info
		set question_type = #{questionType,jdbcType=INTEGER},
		score = #{score,jdbcType=REAL},
		difficulty = #{difficulty,jdbcType=INTEGER},
		STATUS = #{status,jdbcType=INTEGER},
		c_time = #{cTime,jdbcType=TIMESTAMP},
		m_time = #{mTime,jdbcType=TIMESTAMP},
		c_user = #{cUser,jdbcType=VARCHAR},
		m_user = #{mUser,jdbcType=VARCHAR}
		where
		question_id = #{questionId,jdbcType=BIGINT}
	</update>
    <update id="updateQuestionScore"
            parameterType="com.example.study_system.model.QuestionInfo">
		update question_info
		set score =#{score,jdbcType=REAL}
		where
		question_id = #{questionId,jdbcType=BIGINT}
	</update>
    <update id="updateQuestionStatus"
            parameterType="com.example.study_system.model.QuestionInfo">
		update question_info
		set score = 1
		where
		question_id = #{questionId,jdbcType=BIGINT}
	</update>
</mapper>